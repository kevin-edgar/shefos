#!/bin/bash
#
#  Shef OS Install v.2.0
#────────────────────────────────────────────────────────|
#           .
# Author    . LinuxShef
#           .
# Project   . https://github.com/shefpower/manjaroinstall.git
#           .
# License   . LGPL-3.0 (http://opensource.org/licenses/lgpl-3.0.html)
#           .
#──────────────────────────────────────────────────────────────────────|
clear
echo '









                                                 ShefOS Install v.2.0

                      ─────────────────────────────────────────────────────────────────────────



                             ██╗      ██████╗  █████╗ ██████╗ ██╗███╗   ██╗ ██████╗
                             ██║     ██╔═══██╗██╔══██╗██╔══██╗██║████╗  ██║██╔════╝
                             ██║     ██║   ██║███████║██║  ██║██║██╔██╗ ██║██║  ███╗
                             ██║     ██║   ██║██╔══██║██║  ██║██║██║╚██╗██║██║   ██║
                             ███████╗╚██████╔╝██║  ██║██████╔╝██║██║ ╚████║╚██████╔╝██╗██╗██╗
                             ╚══════╝ ╚═════╝ ╚═╝  ╚═╝╚═════╝ ╚═╝╚═╝  ╚═══╝ ╚═════╝ ╚═╝╚═╝╚═╝



                       ─────────────────────────────────────────────────────────────────────────
'
sed -i s/'#en_US.UTF-8'/'en_US.UTF-8'/g /etc/locale.gen
sed -i s/'#ru_RU.UTF-8'/'ru_RU.UTF-8'/g /etc/locale.gen
chmod 777 /etc/locale.conf
chmod 777 /etc/vconsole.conf
echo 'LANG=ru_RU.UTF-8' > /etc/locale.conf
echo 'KEYMAP=ru' > /etc/vconsole.conf
echo 'FONT=cyr-sun16' >> /etc/vconsole.conf
chmod 644 /etc/locale.conf
chmod 644 /etc/vconsole.conf
setfont cyr-sun16
locale-gen >/dev/null 2>&1; RETVAL=$?
systemctl restart dhcpcd
dhcpcd >/dev/null
clear
echo '










             {=-=-=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=}






                    ▄████████    ▄█    █▄       ▄████████    ▄████████       ▄██████▄     ▄████████
                   ███    ███   ███    ███     ███    ███   ███    ███      ███    ███   ███    ███
                   ███    █▀    ███    ███     ███    █▀    ███    █▀       ███    ███   ███    █▀
                   ███         ▄███▄▄▄▄███▄▄  ▄███▄▄▄      ▄███▄▄▄          ███    ███   ███
                 ▀███████████ ▀▀███▀▀▀▀███▀  ▀▀███▀▀▀     ▀▀███▀▀▀          ███    ███ ▀███████████
                          ███   ███    ███     ███    █▄    ███             ███    ███          ███
                    ▄█    ███   ███    ███     ███    ███   ███             ███    ███    ▄█    ███
                  ▄████████▀    ███    █▀      ██████████   ███              ▀██████▀   ▄████████▀




                                                 {  Manjaro based  }

             {=-=--=-=-=-=-=--=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=}

'
sleep 6
clear
echo '













                            ▄▀             Добро пожаловать в программу установки
                        █▀▀▀█▀█
                         ▀▄░▄▀
                           █                            Shef OS  !
                         ▄▄█▄▄
                          <────────────────────────────────────────────────────────────────────>



                              Внимание !  скрипт НЕ создает разделы на диске , разделы вы


                           создаёте сами , поэтому если вы еще не создали разделы - создайте их



                        <───────────────────────────────────────────────────────────────────────────>


'
    echo -e "

      \t                   -> Пропустить введите     1    "

    echo -e "

      \t                   -> Разметить диск введите   2     "

    echo -n "

                           -> Введите значение : "

      read main_menu
      case "$main_menu" in
         "1" ) clear
           ;;
         "2" ) clear ; echo '

















                        Добро пожаловать в меню раметки диска !

            . ────────────────────────────────────────────────────────────.
            .                                                             .
            .                                                             .
            .         Сейчас будет выведена информация о дисках           .
            .                                                             .
            .          Выберите тот диск который надо разметить           .
            .                                                             .
            .                                                             .
            .    ** Имя диска например ( sda , sdb, sdc , nvme0n1p ) **   .
            .                                                             .
            .                                                             .
            . ────────────────────────────────────────────────────────────.
'
sleep 2
read -t 99999 -n 1 -s -r -p "
                         -> Нажмите Enter для продолжения <- "
clear
fdisk -l

sleep 2
read -t 99999 -n 1 -s -r -p "
                         -> Нажмите Enter для продолжения <- "
clear
echo '

















              .─────────────────────────────────────────────────────────────.
              .                                                             .
              .                                                             .
              .             Введите имя диска для разметки                  .
              .                                                             .
              .                                                             .
              ──────────────────────────────────────────────────────────────
'
read -p "
                        -> Введите значение : " namedisk
cfdisk /dev/$namedisk
      esac
clear

echo '








                                    Настройка часового пояса

              .──────────────────────────────────────────────────────────────.
              .                                                              .
              .                                                              .
              .  Настройка региона выставляет часовой пояс и время согласно  .
              .                                                              .
              .                      указаному региону                       .
              .                                                              .
              .  Название региона можно посмотреть в списке регионов или     .
              .                                                              .
              .  ввести вручную , если уже знаете , именно в таком формате   .
              .                                                              .
              .                  Пример -->   /Europe/Moscow                 .
              .                                                              .
              .                                                              .
              .──────────────────────────────────────────────────────────────.

                              Выберите один из варинтов :

'
read -p "
                        -> Введите значение : " region

clear
echo '











                                       Выбор диска

            . ────────────────────────────────────────────────────────────.
            .                                                             .
            .                                                             .
            .  ** Это важно для дальнейщей установки загрузчика GRUB  **  .
            .                                                             .
            .                                                             .
            .         Сейчас будет выведена информация о дисках           .
            .                                                             .
            .   Выберите тот диск на который будет установлена система    .
            .                                                             .
            .            Например ( sda , sdb, sdc , nvme0n1p )           .
            .                                                             .
            .                                                             .
            . ────────────────────────────────────────────────────────────.
'
sleep 2
read -t 99999 -n 1 -s -r -p "
                         -> Нажмите Enter для продолжения <- "
clear
fdisk -l

sleep 2
read -t 99999 -n 1 -s -r -p "
                         -> Нажмите Enter для продолжения <- "

clear
echo '












                                      Выбор диска

              .─────────────────────────────────────────────────────────────.
              .                                                             .
              .                                                             .
              .             Введите имя диска для разметки                  .
              .                                                             .
              .   ** Это важно для дальнейщей установки загрузчика GRUB **  .
              .                                                             .
              .         Например ( sda , sdb, sdc , nvme0n1p )              .
              .                                                             .
              .                                                             .
              ──────────────────────────────────────────────────────────────.
'
read -p "
                        -> Введите значение : " disk
clear
echo '










                                        Выбор разделов

      .────────────────────────────────────────────────────────────────────────────────.
      .                                                                                .
      .                                                                                .
      .                             Введите разделы диска                              .
      .                                                                                .
      .             (Root- Корневой)  (Boot- Загрузочный) (Swap- Подкачка)             .
      .                                                                                .
      .                                                                                .
      .                  Например ( sda2, sdb2, sdc2 , nvme0n1p2 )                     .
      .                                                                                .
      .                                                                                .
      .   ** Внимание ! Если вы не создали swap или home то оставьте поле пустым **    .
      .                                                                                .
      .                                                                                .
      .────────────────────────────────────────────────────────────────────────────────.

'
read -p "
                                 -> Boot: " boot
read -p "
                                 -> Root: " root
read -p "
                                 -> Swap: " swap
read -p "
                                 -> Home: " home

clear
echo '












                          Выбор файловой системы Boot раздела

              .─────────────────────────────────────────────────────────────.
              .                                                             .
              .                                                             .
              .      Выберите файловую систему загрузочного  boot раздела   .
              .                                                             .
              .  Согласно вашей версии Bios (обычный стрый BIOS или UEFI)   .
              .                                                             .
              .   Для UEFI формат FAT32 . Для обычнго BIOS Ext4 или Ext2    .
              .                                                             .
              .                                                             .
              .─────────────────────────────────────────────────────────────.

'
echo -e "\t

                       -> Для UEFI введите     1    "
echo -e "\t



                       -> Не форматировать  введите      2

                      ( Для утсановки в один раздел DOS/MBR или рядом с Windows )"
echo -e "\t




                       -> Для обычного Bios форматировать в Ext4 введите    3   "
echo -e "\t


                       -> Для обычного Bios фоматировать в Ext2 введиет    4   "
echo -n "

                           -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" ) clear ; mkfs.vfat -F32 /dev/$boot
         ;;
         "3" ) clear ; mkfs.ext4 /dev/$boot
         ;;
         "4" ) clear ; mkfs.ext2 /dev/$boot
         ;;
         "2" ) clear
      esac


clear

mkfs.btrfs -f /dev/$root

mkswap /dev/$swap

swapon /dev/$swap

clear

echo '









                                 Монтирование разделов

                            и  домашнего ( home ) раздела

                 .───────────────────────────────────────────────────────.
                 .                                                       .
                 .                                                       .
                 .       Выберите один из вариантов монтирования         .
                 .                                                       .
                 .                                                       .
                 .───────────────────────────────────────────────────────.
'
echo -e "\t


                     ->  Монтировать в BTRFS без Home введите     1     "

echo -e "\t

                     -> Форматировать Home в btrfs и смонтрировать  введите    2    "

echo -n "

                      -> Введите значение : "

read main_menu
      case "$main_menu" in
        "1") clear ;
mount  /dev/$root /mnt

btrfs su cr /mnt/@

btrfs su cr /mnt/@home

btrfs su cr /mnt/@var

btrfs su cr /mnt/@var_log

btrfs su cr /mnt/@snapshots

umount /mnt

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@ /dev/$root /mnt

mkdir /mnt/{boot,home,var,var_log,.snapshots}

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@home  /dev/$root  /mnt/home

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@var  /dev/$root  /mnt/var

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@var_log /dev/$root /mnt/var_log

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@snapshots  /dev/$root  /mnt/.snapshots
        ;;
        "2" ) clear ;
mkfs.btrfs -f /dev/$home

mount  /dev/$root /mnt

btrfs su cr /mnt/@

btrfs su cr /mnt/@home

btrfs su cr /mnt/@var

btrfs su cr /mnt/@var_log

btrfs su cr /mnt/@snapshots

umount /mnt

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@ /dev/$root /mnt

mkdir /mnt/{boot,home,var,var_log,.snapshots}

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@home  /dev/$home  /mnt/home

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@var  /dev/$root  /mnt/var

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@var_log /dev/$root /mnt/var_log

mount -o rw,noatime,compress=zstd:2,space_cache=v2,discard=async,subvol=@snapshots  /dev/$root  /mnt/.snapshots
   esac

clear
echo '












                              Монтирование boot раздела

              .─────────────────────────────────────────────────────────.
              .                                                          .
              .                                                          .
              .          Монтирование загрузочного раздела !             .
              .                                                          .
              .   Выберите один из варинтов монтирования boot раздела    .
              .                                                          .
              .       Для обычного биоса (НЕ UEFI) введите Bios          .
              .                                                          .
              .             Для UEFI биоса , введите Uefi                .
              .                                                          .
              .                                                          .
              .──────────────────────────────────────────────────────────.


'
echo -e "\t
                        -> Для UEFI или EFI введите    1    "
echo -e "\t


                        -> Для обычного Bios введите     2   "

echo -e "\t

                        -> Без boot раздела DOS/MBR      3

                        (Если вы устанавливаете все в один радел для  MBR ) "

echo -n "

                         -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" ) mkdir /mnt/boot/efi ; mount /dev/$boot /mnt/boot/efi
         ;;
         "2" ) mount /dev/$boot  /mnt/boot/
         ;;
         "3" ) clear
      esac

clear
echo '













                                        Парль root
                .───────────────────────────────────────────────────────────.
                .                                                           .
                .                                                           .
                .                   Укажите парль Root !!!                  .
                .                                                           .
                .                                                           .
                .───────────────────────────────────────────────────────────.
'
read -p "
                    -> Введите пароль root :  " password
clear
echo '













                                Учетная запись пользователя
                .───────────────────────────────────────────────────────────.
                .                                                           .
                .                                                           .
                .           Введите имя вашей учетной записи !!!            .
                .                                                           .
                .                                                           .
                .    Имя учетной записи вводится только маленькими буквами  .
                .                                                           .
                .───────────────────────────────────────────────────────────.
'
read -p "
                    -> Введите имя учетной записи :  " username
clear
echo '













                             Парль учетной записи пользователя
                .───────────────────────────────────────────────────────────.
                .                                                           .
                .                                                           .
                .           Укажите парль вашей учетной записи !!!          .
                .                                                           .
                .                                                           .
                .───────────────────────────────────────────────────────────.
'
read -p "
                    -> Введите пароль пользователя :  " userpassword
clear

echo '





                                     Драйвера видеокарты
              .─────────────────────────────────────────────────────────────────.
              .                                                                 .
              .                                                                 .
              .     Добро пожаловать в меню установки графических драйверов     .
              .                                                                 .
              .  На этом этапе будут установлены драйверы для вашей видеокарты  .
              .                                                                 .
              .      Далее вы попадете в меню выбора графических оболочек!      .
              .                                                                 .
              .                                                                 .
              .─────────────────────────────────────────────────────────────────.

'
echo -e "\t
                          -> Для графики Intel введите ( 1 ) "
echo -e "\t

                          -> Для графики AMD введите  ( 2 )  "
echo -e "\t

                          -> Для графики Nvidia введите  ( 3 ) "
echo -e "\t

                          -> Для графики Intel + Nvidia введите ( 4 ) "
echo -e "\t

                          -> Для графики Intel + AMD введите  ( 5 ) "
echo -e "\t

                          -> Для графики Nvidia + AMD введите  ( 6 ) "
echo -n "

                          -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" ) graphc_drivers='basestrap -i /mnt mesa mesa-demos lib32-mesa vulkan-intel lib32-vulkan-intel vulkan-icd-loader lib32-vulkan-icd-loader network-manager-applet libva-intel-driver lib32-libva-intel-driver --noconfirm'
        ;;
         "2" ) graphc_drivers='basestrap -i /mnt mesa mesa-demos lib32-mesa vulkan-radeon lib32-vulkan-radeon vulkan-icd-loader lib32-vulkan-icd-loader network-manager-applet --noconfirm'
        ;;
         "3" ) graphc_drivers='basestrap -i /mnt mesa mesa-demos nvidia-dkms nvidia-utils lib32-nvidia-utils vulkan-icd-loader lib32-vulkan-icd-loader lib32-opencl-nvidia opencl-nvidia network-manager-applet --noconfirm'
        ;;
         "4" ) graphc_drivers='basestrap -i /mnt mesa mesa-demos lib32-mesa vulkan-intel lib32-vulkan-intel vulkan-icd-loader lib32-vulkan-icd-loader nvidia-dkms nvidia-utils lib32-nvidia-utils vulkan-icd-loader lib32-vulkan-icd-loader lib32-opencl-nvidia opencl-nvidia network-manager-applet --noconfirm'
        ;;
         "5" ) graphc_drivers='basestrap -i /mnt mesa mesa-demos lib32-mesa vulkan-intel lib32-vulkan-intel vulkan-icd-loader lib32-vulkan-icd-loader vulkan-radeon lib32-vulkan-radeon vulkan-icd-loader lib32-vulkan-icd-loader network-manager-applet --noconfirm'
        ;;
         "6" ) graphc_drivers='basestrap -i /mnt mesa mesa-demos lib32-mesa vulkan-radeon lib32-vulkan-radeon vulkan-icd-loader lib32-vulkan-icd-loader nvidia-dkms nvidia-utils lib32-nvidia-utils vulkan-icd-loader lib32-vulkan-icd-loader lib32-opencl-nvidia opencl-nvidia network-manager-applet --noconfirm'
      esac

#----------------------------------------------------------------------|
#                                                      #
#                         Pacman                       #
#                                                      #
#----------------------------------------------------------------------|
clear
sed -i "/\[multilib\]/,/Include/"'s/^#//' /etc/pacman.conf
sed -i s/'#ParallelDownloads = 5'/'ParallelDownloads = 5'/g /etc/pacman.conf
sed -i s/'#VerbosePkgLists'/'VerbosePkgLists'/g /etc/pacman.conf
sed -i s/'#Color'/'ILoveCandy'/g /etc/pacman.conf
sed -i s/'CheckSpace'/'#CheckSpace'/g /etc/pacman.conf
sed -i s/'#VerbosePkgLists'/'VerbosePkgLists'/g /etc/pacman.conf
echo '









───────────────────────────────────────────────────────────────|
──────────────────────
────────────────────── ██████╗  █████╗  ██████╗███╗   ███╗ █████╗ ███╗   ██╗
────────────────────── ██╔══██╗██╔══██╗██╔════╝████╗ ████║██╔══██╗████╗  ██║
──▒▒▒▒▒────▄████▄───── ██████╔╝███████║██║     ██╔████╔██║███████║██╔██╗ ██║
─▒─▄▒─▄▒──███▄█▀────── ██╔═══╝ ██╔══██║██║     ██║╚██╔╝██║██╔══██║██║╚██╗██║
─▒▒▒▒▒▒▒─▐████──█──█── ██║     ██║  ██║╚██████╗██║ ╚═╝ ██║██║  ██║██║ ╚████║
─▒▒▒▒▒▒▒──█████▄────── ╚═╝     ╚═╝  ╚═╝ ╚═════╝╚═╝     ╚═╝╚═╝  ╚═╝╚═╝  ╚═══╝
─▒─▒─▒─▒───▀████▀─────────────────────────────────────────────────────────────────|

                       Пожалуйста пдождите , идет настройка скачивания пакетов,

                                  это займет пару мнгновений ) .......

              ─────────────────────────────────────────────────────────────────────────────────────|
'
sleep 4

pacman-mirrors --fasttrack
pacman -Syy
pacman -Sy arch-install-scripts --noconfirm
basestrap -i /mnt base base-devel linux60 linux60-headers linux-firmware dosfstools btrfs-progs xf86-video-intel intel-ucode amd-ucode iucode-tool xf86-video-amdgpu xf86-video-nouveau archlinux-keyring manjaro-keyring cups bluez bluez-utils manjaro-tools-base networkmanager dhcpcd dhclient vim nano pipewire pipewire-alsa pipewire-jack pipewire-media-session manjaro-pipewire --noconfirm
fstabgen -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt /bin/bash -c "ln -sf /usr/share/zoneinfo/$region /etc/localtime"
arch-chroot /mnt /bin/bash -c "hwclock --systohc"
arch-chroot /mnt /bin/bash -c "sed -i s/'#en_US.UTF-8'/'en_US.UTF-8'/g /etc/locale.gen"
arch-chroot /mnt /bin/bash -c "sed -i s/'#ru_RU.UTF-8'/'ru_RU.UTF-8'/g /etc/locale.gen"
arch-chroot /mnt /bin/bash -c "locale-gen"
arch-chroot /mnt /bin/bash -c "echo 'LANG=ru_RU.UTF-8' > /etc/locale.conf"
arch-chroot /mnt /bin/bash -c "echo 'KEYMAP=ru' > /etc/vconsole.conf"
arch-chroot /mnt /bin/bash -c "echo 'FONT=cyr-sun16' >> /etc/vconsole.conf"
arch-chroot /mnt /bin/bash -c "echo 'Manjaro' > /etc/hostname"
arch-chroot /mnt /bin/bash -c "echo '127.0.0.1 localhost' > /etc/hosts"
arch-chroot /mnt /bin/bash -c "echo '::1       localhost' >> /etc/hosts"
arch-chroot /mnt /bin/bash -c "echo '127.0.0.1 Manjaro.localdomain Manjaro' >> /etc/hosts"
#----------------------------PACMAN--------------------------------------------------------------
arch-chroot /mnt /bin/bash -c "sed -i s/'#ParallelDownloads = 5'/'ParallelDownloads = 5'/g /etc/pacman.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'#VerbosePkgLists'/'VerbosePkgLists'/g /etc/pacman.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'#Color'/'ILoveCandy'/g /etc/pacman.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'CheckSpace'/'#CheckSpace'/g /etc/pacman.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'#VerbosePkgLists'/'VerbosePkgLists'/g /etc/pacman.conf"
#-------------------------------------------------------------------------------------------------
arch-chroot /mnt /bin/bash -c "sed -i s/'# %wheel ALL=(ALL:ALL) ALL'/'%wheel ALL=(ALL:ALL) ALL'/g /etc/sudoers"
#----------------------------SUDOERS------------------------------------------------------------------
echo "root:$password" | arch-chroot /mnt chpasswd
arch-chroot /mnt /bin/bash -c "mkinitcpio -P"
arch-chroot /mnt /bin/bash -c "pacman -Syy grub grub-btrfs efibootmgr --noconfirm"
arch-chroot /mnt /bin/bash -c "useradd -m -G wheel -s /bin/bash $username"
echo "$username:$userpassword" | arch-chroot /mnt chpasswd
arch-chroot /mnt /bin/bash -c "systemctl enable NetworkManager"
arch-chroot /mnt /bin/bash -c "grub-install /dev/$disk"
arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
arch-chroot /mnt /bin/bash -c "sed -i s/'GRUB_DEFAULT=saved'/'GRUB_DEFAULT=0'/g /etc/default/grub"
arch-chroot /mnt /bin/bash -c "sed -i s/'GRUB_TIMEOUT=5'/'GRUB_TIMEOUT=0'/g /etc/default/grub"
arch-chroot /mnt /bin/bash -c "sed -i s/'GRUB_SAVEDEFAULT=true'/'GRUB_SAVEDEFAULT=false'/g /etc/default/grub"
arch-chroot /mnt /bin/bash -c "sed -i s/'MODULES=()'/'MODULES=(crc32c libcrc32c zlib_deflate btrfs)'/g /etc/mkinitcpio.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'HOOKS=(base udev autodetect modconf kms keyboard keymap consolefont block filesystems fsck)'/'HOOKS=(base udev autodetect modconf kms keyboard keymap block filesystems fsck)'/g /etc/mkinitcpio.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'CFLAGS="-march=x86-64 -mtune=generic -O2 -pipe -fno-plt -fexceptions \
        -Wp,-D_FORTIFY_SOURCE=2 -Wformat -Werror=format-security \
        -fstack-clash-protection -fcf-protection"'/'CFLAGS="-march=native -mtune=native -O2 -pipe -fno-plt"'/g /etc/makepkg.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'CXXFLAGS="$CFLAGS -Wp,-D_GLIBCXX_ASSERTIONS"'/'CXXFLAGS="-march=native -mtune=native -O2 -pipe -fno-plt"'/g /etc/makepkg.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'#RUSTFLAGS="-C opt-level=2"'/'RUSTFLAGS="-C opt-level=2 -C target-cpu=native"'/g /etc/makepkg.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'MAKEFLAGS="-j2"'/'MAKEFLAGS="-j$(($(nproc)+1))"'/g /etc/makepkg.conf"
arch-chroot /mnt /bin/bash -c "mkinitcpio -P"
arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
arch-chroot /mnt /bin/bash -c "pacman-mirrors --fasttrack"
arch-chroot /mnt /bin/bash -c "pacman -Syyuu --noconfirm"
#-------------------------------------------------------------------------------------------
${graphc_drivers}
#-------------------------------------------------------------------------------------------
pacman -Syy
basestrap -i /mnt xorg xorg-server xdg-utils xorg-xinit xdg-user-dirs plasma sddm sddm-kcm konsole kmix dolphin nemo discover manjaro-settings-manager manjaro-settings-manager-kcm manjaro-icons manjaro-printer print-manager kmix pavucontrol pipewire pipewire-jack pipewire-alsa pipewire-media-session flameshot kcalc ark screenfetch neofetch htop bpytop gnome-usage firefox gwenview dragon kwrite mousepad easyeffects conky gparted timeshift timeshift-autosnap-manjaro manjaro-input baobab libpamac libpamac-flatpak-plugin libpamac-snap-plugin pamac-cli pamac-gtk webapp-manager-manjaro noto-fonts-emoji ttf-font-awesome ttf-dejavu ttf-ubuntu-font-family libappimage appimagelauncher xapp-appimage-thumbnailer ffmpegthumbnailer ffmpegthumbs yay openvpn networkmanager-openvpn git wget cups manjaro-pipewire os-prober go zsh zsh-completions qemu-desktop gnome-boxes libvirt virt-manager telegram-desktop spectacle udisks2 gvfs-mtp gvfs-gphoto2 gvfs-afc gvfs-smb sshfs cups tumbler poppler-glib ffmpegthumbnailer freetype2 libgsf totem evince atril gnome-epub-thumbnailer file-roller file-roller unzip ntfs-3g imagemagick ffmpegthumbs flac wavpack lame  a52dec  libdca  libmad  libmpcdec  opencore-amr opus  speex libvorbis faac faad2 libfdk-aac  fdkaac  jasper libwebp libavif  libheif aom dav1d rav1e svt-av1  libde265 libdv libmpeg2 schroedinger  libtheora  libvpx  x264 x265  xvidcore  mkvtoolnix-cli mkvtoolnix-gui ogmtools gstreamer xine-lib gst-libav ffmpeg qt6-multimedia-ffmpeg ktorrent qbittorrent --noconfirm
#-------------------------------------
arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
arch-chroot /mnt /bin/bash -c "systemctl enable bluetooth"
arch-chroot /mnt /bin/bash -c "systemctl enable cups"
arch-chroot /mnt /bin/bash -c "systemctl enable NetworkManager"
arch-chroot /mnt /bin/bash -c "systemctl enable sddm --force"
#----------------------------------------------------------------------|
#                                                      #
#                     Umount and Exit                  #
#                                                      #
#----------------------------------------------------------------------|
echo '













───────────────────────────────────────────────────────────────────>
░░░░░░░░░░░░▄▄░░░░░░░░░
░░░░░░░░░░░█░░█░░░░░░░░
░░░░░░░░░░░█░░█░░░░░░░░
░░░░░░░░░░█░░░█░░░░░░░░
░░░░░░░░░█░░░░█░░░░░░░░
███████▄▄█░░░░░██████▄░░
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░              Установка успешно завершена . Сейчас компьютер будет перезагружен .
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░
▓▓▓▓▓▓█████░░░░░░░░░█░░
██████▀░░░░▀▀██████▀░░░░
  <─────────────────────────────────────────────────────────────────────────────────────────────────────────>


'
sleep 5
arch-chroot /mnt /bin/bash -c "exit"
umount -R /mnt
clear
reboot
